@(seq:String)(implicit session: Session)
@home.main("Blast") {

    <style>
            .db {
                width: 583px;
            }
    </style>

    <div class="row">
        <div class="form-group col-sm-12">
            <h2 class="page-heading">Blast</h2>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-2">
            <div class="bs-docs-sidebar" role="complementary">
                <ul class="nav bs-docs-sidenav">
                    <li  class="active"><a href="#blastn_genome" data-toggle="tab">Blastn Genome</a></li>
                    <li><a href="#blastn" data-toggle="tab">Blastn Gene</a></li>
                    <li><a href="#blastp" data-toggle="tab">Blastp</a></li>
                    @* <li><a href="#blastx" data-toggle="tab">Blastx</a></li>*@

                </ul>
            </div>
        </div>

        <div class="col-sm-9 tab-content myform" >

            <div class="tab-pane " id="blastn">
                <form class="form-horizontal" method="get" id="form">
                    <h4>Blastn Gene:</h4>
                    <hr>

                    <input class="form-control" name="blastType" value="blastn" style="display: none;">

                    <div class="form-group">
                        <label class="control-label col-sm-3">Type of query:</label>
                        <div class="col-sm-4">
                            <select class="form-control" onchange="change(this, 'blastn')" name="method">
                                <option selected value="text">Text</option>
                                <option value="geneid">Gene ID</option>
                                <option value="file">File</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group" id="blastnQueryContent">
                        <label class="control-label col-sm-3">Enter FASTA sequences:</label>
                        <div class="col-sm-8">
                            <textarea class="form-control monospace" name="queryText" id="queryText" rows="5"></textarea>
                            <span class="help-block">
                                e.g.,&nbsp;<a href="#" onclick="showExample('dna', 'form')"><em id="egQuery">
                                example</em></a></span>
                        </div>
                    </div>

                    <div class="form-group" id="blastnQueryGeneid" style="display: none;">
                        <label class="control-label col-sm-3">Enter Gene ID:</label>
                        <div class="col-sm-8">
                            <textarea class="form-control monospace" name="queryGeneid" id="queryGeneid" rows="5"></textarea>
                            <span class="help-block">
                                e.g.,&nbsp;<a href="#" onclick="showGeneidExample('form')"><em id="egQuery">
                                example</em></a></span>
                        </div>
                    </div>

                    <div class="form-group" id="blastnQueryFile" style="display: none;">
                        <label class="control-label col-sm-3">upload file:</label>
                        <div class="col-sm-8">
                            <input id="input-1" type="file" class="file control-label" name="file" data-show-preview="false"
                            data-show-upload="false" accept=".fa,.fasta">
                            <span class="help-block"><a href="/eucalyptus/utils/downloadExample?example=blastn_example.fasta"><em id="egCrics">
                                Example_File</em></a></span>
                        </div>
                    </div>

                    <div class="form-group" id="againstType">
                        <label class="control-label col-sm-3">Database:</label>
                        <div class="col-sm-8">
                            <div id="genedb" onclick="changeMaxTargetSeqs('#blastn', '#genedb')"></div>

                            <div style="width: 180px;
                                padding-top: 10px">
                                <input type="button" value="Select All" class="btn btn-primary" onclick="selectAll('blastn', 'form')" />
                                <input type="button" value="Inverse" class="btn btn-primary" onclick="inverse('blastn', 'form')"/>
                            </div>


                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-sm-3">Evalue:</label>
                        <div class="col-sm-2">
                            <input class="form-control" name="evalue" id="evalue" value="1e-5">
                        </div>

                        <label class="control-label col-sm-3">Word size:</label>
                        <div class="col-sm-2">
                            <input class="form-control" name="wordSize" id="wordSize" value="28">
                        </div>

                    </div>

                    <div class="form-group">
                        <label class="control-label col-sm-3">Max target seqs:</label>
                        <div class="col-sm-2">
                            <input class="form-control" name="maxTargetSeqs" id="maxTargetSeqs" value="2">
                        </div>
                    </div>

                    <div class="form-group" style="display: none">

                        <label class="control-label col-sm-3">Percent query coverage per hsp:</label>
                        <div class="col-sm-2">
                            <input class="form-control" name="qcovHspPerc" id="qcovHspPerc" value="0">
                        </div>
                    </div>

                    <hr>
                    <div class="form-group">
                        <div class="actions col-sm-offset-3 col-sm-3">
                            <button type="button" class="btn btn-primary" style="width: 90%;" id="search"
                            onclick="blast_2('form')">
                                Search</button>
                        </div>
                        <div class="actions  col-sm-3">
                            <button type="reset" class="btn btn-primary" style="width: 90%;">
                                Reset</button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="tab-pane active" id="blastn_genome">
                <form class="form-horizontal" method="get" id="formGenome">
                    <h4>Blastn Genome:</h4>
                    <hr>

                    <input class="form-control" name="blastType" value="blastnGenome" style="display: none;">

                    <div class="form-group">
                        <label class="control-label col-sm-3">Type of query:</label>
                        <div class="col-sm-4">
                            <select class="form-control" onchange="change(this, 'blastn_genome')" name="method">
                                <option selected value="text">Text</option>
                                <option value="geneid">Gene ID</option>
                                <option value="file">File</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group" id="blastn_genomeQueryContent">
                        <label class="control-label col-sm-3">Enter FASTA sequences:</label>
                        <div class="col-sm-8">
                            <textarea class="form-control monospace" name="queryText" id="queryText" rows="5"
                             >@seq</textarea>
                            <span class="help-block">
                                e.g.,&nbsp;<a href="#" onclick="showExample('dna', 'formGenome')"><em id="egQuery">
                                example</em></a></span>
                        </div>
                    </div>

                    <div class="form-group" id="blastn_genomeQueryGeneid" style="display: none;">
                        <label class="control-label col-sm-3">Enter Gene ID:</label>
                        <div class="col-sm-8">
                            <textarea class="form-control monospace" name="queryGeneid" id="queryGeneid" rows="5"></textarea>
                            <span class="help-block">
                                e.g.,&nbsp;<a href="#" onclick="showGeneidExample('formGenome')"><em id="egQuery">
                                example</em></a></span>
                        </div>
                    </div>

                    <div class="form-group" id="blastn_genomeQueryFile" style="display: none;">
                        <label class="control-label col-sm-3">upload file:</label>
                        <div class="col-sm-8">
                            <input id="input-1" type="file" class="file control-label" name="file" data-show-preview="false"
                            data-show-upload="false" accept=".fa,.fasta">
                            <span class="help-block"><a href="/eucalyptus/utils downloadExample?example=blastn_example.fasta"><em id="egCrics">
                                Example_File</em></a></span>
                        </div>
                    </div>

                    <div class="form-group" id="againstType">
                        <label class="control-label col-sm-3">Database:</label>
                        <div class="col-sm-8">
                            <div id="genomedb" onclick="changeMaxTargetSeqs('#formGenome', '#genomedb')"></div>
                            <div style="width: 180px;
                                padding-top: 10px">
                                <input type="button" value="Select All" class="btn btn-primary" onclick="selectAll('blastn_genome', 'formGenome')" />
                                <input type="button" value="Inverse" class="btn btn-primary" onclick="inverse('blastn_genome', 'formGenome')"/>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-sm-3">Evalue:</label>
                        <div class="col-sm-2">
                            <input class="form-control" name="evalue" id="evalue" value="1e-5">
                        </div>

                        <label class="control-label col-sm-3">Word size:</label>
                        <div class="col-sm-2">
                            <input class="form-control" name="wordSize" id="wordSize" value="28">
                        </div>

                    </div>

                    <div class="form-group">
                        <label class="control-label col-sm-3">Max target seqs:</label>
                        <div class="col-sm-2">
                            <input class="form-control" name="maxTargetSeqs" id="maxTargetSeqs" value="2">
                        </div>

                        <label class="control-label col-sm-3">Percent query coverage per hsp:</label>
                        <div class="col-sm-2">
                            <input class="form-control" name="qcovHspPerc" id="qcovHspPerc" value="0">
                        </div>

                    </div>


                    <hr>
                    <div class="form-group">
                        <div class="actions col-sm-offset-3 col-sm-3">
                            <button type="button" class="btn btn-primary" style="width: 90%;" id="search"
                            onclick="blast_2('formGenome')">
                                Search</button>
                        </div>
                        <div class="actions  col-sm-3">
                            <button type="reset" class="btn btn-primary" style="width: 90%;">
                                Reset</button>
                        </div>
                    </div>
                </form>
            </div>
                <!--Transcript -->
            <div class="tab-pane" id="blastp">
                <form class="form-horizontal" method="get" id="blastpForm">
                    <h4>Blastp:</h4>
                    <hr>

                    <input class="form-control" name="blastType" value="blastp" style="display: none;">


                    <div class="form-group">
                        <label class="control-label col-sm-3">Type of query:</label>
                        <div class="col-sm-4">
                            <select class="form-control" onchange="change(this, 'blastp')" name="method">
                                <option selected value="text">Text</option>
                                <option value="geneid">Gene ID</option>
                                <option value="file">File</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group" id="blastpQueryContent" >
                        <label class="control-label col-sm-3">Enter FASTA sequences:</label>
                        <div class="col-sm-8">
                            <textarea class="form-control monospace" name="queryText" id="queryText" rows="5"></textarea>
                            <span class="help-block">
                                e.g.,&nbsp;<a href="#" onclick="showExample('protein', 'blastpForm')"><em id="egQuery">
                                example</em></a></span>
                        </div>
                    </div>

                    <div class="form-group" id="blastpQueryGeneid" style="display: none;">
                        <label class="control-label col-sm-3">Enter Gene ID:</label>
                        <div class="col-sm-8">
                            <textarea class="form-control monospace" name="queryGeneid" id="queryGeneid" rows="5"></textarea>
                            <span class="help-block">
                                e.g.,&nbsp;<a href="#" onclick="showGeneidExample( 'blastpForm')"><em id="egQuery">
                                example</em></a></span>
                        </div>
                    </div>

                    <div class="form-group" id="blastpQueryFile" style="display: none;">
                        <label class="control-label col-sm-3">Upload file:</label>
                        <div class="col-sm-8">
                            <input id="input-1" type="file" class="file control-label" name="file" data-show-preview="false"
                            data-show-upload="false">
                            <span class="help-block"><a href="/eucalyptus/utils/downloadExample?example=blastp_example.fasta"><em>
                                Example file</em></a></span>
                        </div>
                    </div>

                    <div class="form-group" id="againstType">
                        <label class="control-label col-sm-3">Database:</label>
                        <div class="col-sm-8">

                            <div id="pepdb" onclick="changeMaxTargetSeqs('#blastpForm', '#pepdb')"></div>
                            <div style="width: 180px;
                                padding-top: 10px">
                                <input type="button" value="Select All" class="btn btn-primary" onclick="selectAll('blastp', 'blastpForm')" />
                                <input type="button" value="Inverse" class="btn btn-primary" onclick="inverse('blastp', 'blastpForm')"/>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-sm-3">Evalue:</label>
                        <div class="col-sm-2">
                            <input class="form-control" name="evalue" id="evalue" value="1e-5">
                        </div>

                        <label class="control-label col-sm-3">Word size:</label>
                        <div class="col-sm-2">
                            <input class="form-control" name="wordSize" id="wordSize" value="3">
                        </div>

                    </div>

                    <div class="form-group">
                        <label class="control-label col-sm-3">Max target seqs:</label>
                        <div class="col-sm-2">
                            <input class="form-control" name="maxTargetSeqs" id="maxTargetSeqs" value="2">
                        </div>
                    </div>

                    <div class="form-group" style="display: none">

                        <label class="control-label col-sm-3">Percent query coverage per hsp:</label>
                        <div class="col-sm-2">
                            <input class="form-control" name="qcovHspPerc" id="qcovHspPerc" value="0">
                        </div>
                    </div>

                    <hr>
                    <div class="form-group">
                        <div class="actions col-sm-offset-3 col-sm-3">
                            <button type="button" class="btn btn-primary" style="width: 90%;" id="search"
                            onclick="blast_2('blastpForm')">
                                Search</button>
                        </div>
                        <div class="actions  col-sm-3">
                            <button type="reset" class="btn btn-primary" style="width: 90%;">
                                Reset</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <a href="#result"><div id="showResult"></div></a>

    <div id="result" style="display: none">
        <hr>
        <h4 style="color: black">Result:</h4>
        <button class="btn btn-primary down" onclick="downloadExcel()">Download</button>
        <iframe id="frame" style="width: 1200px;" height="1000px" frameborder="0" align="middle">

        </iframe>

    </div>

    <script>


            var database = ["02428","9311","Basmati1","CG14","CN1","D62", "DG","DHX2","FH838","FS32","G46","G8","G630",
                    "II32","IR64","J4155","KY131","Lemont","LJ","N22", "NamRoo","Y3551","R498","R527","S548","TM","Tumba","WSSM",
                    "Y58S","Kosh","YX1","ZH11","MSU"];


            var relation = ["02428","9311","Basmati1","CG14","CN1","D62", "DG","DHX2","FH838","FS32","G46","G8","G630",
                "II32","IR64","J4155","KY131","Lemont","LJ","N22", "NamRoo","Y3551","R498","R527","S548","TM","Tumba","WSSM",
                "Y58S","Kosh","YX1","ZH11","MSU"];


            var geneDatabase = "";
            var genomeDatabase = "";
            var pepDatabase = "";

            $.each(database, function (i, v) {
                geneDatabase += "<label style='width:110px;float: left' ><input type='checkbox' name='db[]' value='" + relation[i] + "_cds.fasta' class='blastn_data'/> " + v + "</label>" ;
                genomeDatabase += "<label style='width:110px;float: left' ><input type='checkbox' name='db[]' value='" + relation[i] + ".genome' class='blastn_genome_data'/> " + v + "</label>" ;
                pepDatabase += "<label style='width:110px;float: left' ><input type='checkbox' name='db[]' value='" + relation[i] + "_pep.fasta' class='blastp_data'/> " + v + "</label>" ;
            });

            $("#genedb").html(geneDatabase);
            $("#genomedb").html(genomeDatabase);
            $("#pepdb").html(pepDatabase);


            function changeMaxTargetSeqs(formid, dbid) {
                var id = formid + " " + dbid
                console.log(id)
                $(id).click(function () {
                    var count = 0;
                    $(id + " input:checkbox:checked").each(function () {
                        count += 1
                    })
                    $(formid + " #maxTargetSeqs").val(count + 2);

                });
            }


            function selectAll(obj, form) {
                $("." + obj + "_data").prop("checked", true);
                $("#" + obj + " #maxTargetSeqs").val("34");
                $("#" + form).formValidation("revalidateField", "db[]")
            }

            function inverse(obj, form) {
                $("." + obj + "_data").prop("checked", false);
                $("#" + obj + " #maxTargetSeqs").val("2");
                $("#" + form).formValidation("revalidateField", "db[]")
            }


            var excel = "";


            var dna = ">example1\n" +
                    "ATGGGTGTGCAGCAACTGGGAGGCGCCGGCGGCGGGCGCGGGGGCGGCCGGCGGAGCCGCCGAGGTCGCCGTGAGGCACCACCGCGCCTTGCCCACCGGT" +
                    "GCGCCGACGAAGGACTCCGGGCTCCTCTCCGCGTGGATGCAATCAAGGGAAGCCACAGTACAGTCTCCTGTATGGCGCAGGTGCGAGCATGGAATACACC" +
                    "CATTTGGTGA\n" +
                    ">example2\n" +
                    "ATGCAGCGGCGGCGGGGCCTCGCCGCGCTCGCCGTCCTCCTCGCCCTCGCGGCGCGCGGCGCGGACGCGTCCGTCCACGAGTACTCGGGCGGGGGGTTCG" +
                    "CGCCGCGGGCCAACTCCTTCTTCTTCCACGGCGGCAGCGAGGGGCTGTACGCCTCCGACCCCACCTCCAACTCCTCCGCCTCCTTCATCAGGTTTGACTC" +
                    "TGTCACATTTCGACGGACCCAGGAGTCAGCAGGTAGGCATGAGGCTATGCAGCAAAAGACAGGGTTAGTTGAGGCTATTATTGTTGAGATCCAGGACAGA" +
                    "AGCAAGATTGGTGGTTCTTACTTGCATTCTGATGCAATATGCTGCACTCCTGAGCTCGATAAAGAGAAGTCCTGCAAAGTTGGTGAAGTAATTATACAGC" +
                    "CAAATCCTGATAATCCTGACTGGCCAAAAAGGGTTCAGACATTTTTTAGTGGTAGAGATGAAGAAGCTAGCATGGTCACACAAGTTGTATCTATAAACAA" +
                    "AACAGGGATGTACTACCTCTATTTTATGTTCTGTGATCCACAGCTCAAGGGATTGAAGATTACAGGCAGGACTGTTTGGCGAAACCCACAAGGTTATCTC" +
                    "CCTGGTAAAATGGCCCCAATGATGACATTTTATGGTTTCATGTCGCTTGCATATCTTGTACTTGGACTTCTGTGGTTTCTTCAGTTTGTGCGATGCTGGA" +
                    "AGGATATTTTGCAGCTGCACTACCATATAACAGCTGTTATTGCTCTTGGCATGTGCGAGATGGCTTTCTGGTACTTTGAGTATGCTAACTTCAATTCGAC" +
                    "TGGAAACAGACCTATGGCTATAACCTTGTGGGCAGTTACATTTACTGCTGTGAAGAAGACCATATCTCGCCTTCTTTTATTAGTGGTTTCTATGGGATAT" +
                    "GGTGTTGTTAGACCCACATTAGGTGGGGTTACATCTAAAGTAGGTGCTCTTGGTGTCGTCTATTTTATTGCTTCGGAAGGTCTTGAACTTGTTGAAAATC" +
                    "TTGGAAACATCAATGACTTCTCTGGGAAAACAAGGTTATTTCTGGTGTTACCTGTTGCCATACTTGATGCTACCTTCATTATCTGGATATTTTCATCGCT" +
                    "CTCGAGAACTTTGGAGAAGCTCCAGCTGCGGAGAAGTATGGCAAAACTTGAATTGTATCGGAAGTTTACAAATTCTCTAGCTTTGTCAGTTCTTATCTCT" +
                    "ATTGCTTGGATTGGCTATGAGGTATGA\n";
            var pro = ">example1\n" +
                    "MAASPPWANLVSAVVGEIANHLPCEFDRVHFAAVCRSWRASLEQQAPVPLPPALPVLILPLAERPAVSFVLSNCAIHPAVLPEWPHDARYIGAYDDGWSS" +
                    "SPLLHLEVLESTASSTPKTPALTSTSPPSSSRSRTERPGRNGSCRSPSSPPPSRPNQTSTDASSPASSALTPSPGASGRLGSGAPPIG\n" +
                    ">example2\n" +
                    "MAELCIQGLWTHEPPLYFQACGWDAPSAMQEAALQAIVYYRHYRPGLDGFFHFFPARANQSSANYYPGLEGNMREIDTPGLFLAGLVRAMDRYLAKTITE" +
                    "LRRLQARVVMLDRRIEPLGHQGHFDNAIIYGNHELQPLTETLPPPMGIYHNINTRARMRVGFHRNRRTMPDPALAGDPVLLGPFYEFERNGRQYRLTMAT" +
                    "PSTTVPQPPIGFSEVP\n";

            $(function () {
                formValidation();
            });


            function change(element, t) {
                var value = $(element).find(">option:selected").val();
                if (value == "text") {
                    $(".fileinput-remove-button").click();
                    $(".monospace").val("");
                    $("#" + t + "QueryContent").show();
                    $("#" + t + "QueryGeneid").hide();
                    $("#" + t + "QueryFile").hide();
                }else if(value == "geneid"){
                    $(".fileinput-remove-button").click();
                    $(".monospace").val("");
                    $("#" + t + "QueryContent").hide();
                    $("#" + t + "QueryGeneid").show();
                    $("#" + t + "QueryFile").hide()
                } else {
                    $(".monospace").val("");
                    $("#" + t + "QueryContent").hide();
                    $("#" + t + "QueryGeneid").hide();
                    $("#" + t + "QueryFile").show()
                }
            }

            function downloadExcel() {
                var fileName = "blast_2.xls";
                var content = excel;
                var blob = new Blob([content], {
                    type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"
                });
                saveAs(blob, fileName)
            }

            function showGeneidExample(formId) {
                var geneid = "Os02428G0100000100.01\nOs02428G0180000581.01\nOs02428G0100000300.01\nOs02428G0100000500.01";
                $("#" + formId + " #queryGeneid").val(geneid);
                $("#" + formId).formValidation("revalidateField", "queryText")
            }

            function showExample(type, formId) {
                var seq = "";

                if (type == "protein") {
                    seq = pro;
                } else {
                    seq = dna;
                }

                $("#" + formId + " #queryText").val(seq);
                $("#" + formId).formValidation("revalidateField", "queryText")
            }

            function blast_2(formId) {
                var form = $("#" + formId)
                var fv = form.data("formValidation");
                fv.validate();
                if (fv.isValid()) {
                    var form1 = new FormData($("#" + formId)[0]);

                    var element = "<div id='content'><span id='info'>Query...</span>&nbsp;<img class='runningImage' src='/assets/images/running2.gif' style='width: 30px;height: 20px;'></div>"
                    var index = layer.alert(element, {
                        skin: 'layui-layer-lan'
                        , closeBtn: 0,
                        title: "Info",
                        btn: []
                    });

                    $.ajax({
                        url: "@routes.BlastController.blastRun()",
                        type: "post",
                        processData: false,
                        contentType: false,
                        data: form1,
                        success: function (data) {
                            if (data.valid == "false") {
                                layer.close(index);
                                swal("Error", data.message, "error");
                                $("#result").hide()
                            } else {
                                $("#frame").attr("src", "/Eggplant/blastResultBefore?path=" + data.html + "&types=" + data.types);
                                excel = data.excel;

                                if (data.types === "blastnGenome") {
                                    window.setTimeout(function () {
                                        layer.close(index);
                                        $("#result").show();
                                        //click事件不能直接绑定在a标签上，必须在a标签内的元素里
                                        $("#showResult").click();
                                    }, 1000)
                                } else {
                                    layer.close(index);
                                    $("#result").show();
                                    //click事件不能直接绑定在a标签上，必须在a标签内的元素里
                                    $("#showResult").click();
                                }
                            }
                        }
                    });
                }
            }

            function formValidation() {
                var maxSize = 20480000;
                $('#form').formValidation({
                    framework: 'bootstrap',
                    icon: {
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {
                        file: {
                            validators: {
                                notEmpty: {
                                    message: "Query fasta is required!"
                                },
                                file: {
                                    extension: 'fa,fasta',
                                    maxSize: maxSize,
                                    message: 'Query fasta file must be fasta file and file size must be <= 20MB！'
                                }
                            }
                        },
                        queryText: {
                            validators: {
                                notEmpty: {
                                    message: "Please either enter sequences into the box!"
                                },
                                callback: {
                                    message: 'Query sequence length must be <= 20MB!',
                                    callback: function (seqs) {
                                        var line = seqs.split("\n");
                                        var length = 0;
                                        $.each(line, function (i, v) {
                                            if (v.indexOf(">") == -1) {
                                                length += v.length
                                            }
                                        });
                                        if (length > maxSize) return false;
                                        else return true;
                                    }
                                }
                            }
                        },
                        queryGeneid: {
                            validators: {
                                notEmpty: {
                                    message: "Please either enter geneid into the box!"
                                }
                            }
                        },
                        'db[]': {
                            validators: {
                                notEmpty: {
                                    message: "Database is required！"
                                }
                            }
                        },
                        evalue: {
                            validators: {
                                notEmpty: {
                                    message: 'Evalue is required！'
                                },
                                numeric: {
                                    message: 'Evalue must be number！'
                                },
                                greaterThan: {
                                    value: 0,
                                    message: "Evalue must greater than or equal to 0！"
                                }
                            }
                        },
                        wordSize: {
                            validators: {
                                notEmpty: {
                                    message: 'Word size is required！'
                                },
                                integer: {
                                    message: 'Word size must be intger！'
                                },
                                greaterThan: {
                                    value: 4,
                                    message: "Word size must greater than or equal to 4！"
                                }
                            }
                        },
                        maxTargetSeqs: {
                            validators: {
                                notEmpty: {
                                    message: 'Max target seqs is required！'
                                },
                                integer: {
                                    message: 'Max target seqs must be integer！'
                                },
                                greaterThan: {
                                    value: 0,
                                    message: "Max target seqs must greater than or equal to 0！"
                                }
                            }
                        }
                    }
                });
                $('#formGenome').formValidation({
                    framework: 'bootstrap',
                    icon: {
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {
                        file: {
                            validators: {
                                notEmpty: {
                                    message: "Query fasta is required!"
                                },
                                file: {
                                    extension: 'fa,fasta',
                                    maxSize: maxSize,
                                    message: 'Query fasta file must be fasta file and file size must be <= 20MB！'
                                }
                            }
                        },
                        queryText: {
                            validators: {
                                notEmpty: {
                                    message: "Please either enter sequences into the box!"
                                },
                                callback: {
                                    message: 'Query sequence length must be <= 20MB!',
                                    callback: function (seqs) {
                                        var line = seqs.split("\n");
                                        var length = 0;
                                        $.each(line, function (i, v) {
                                            if (v.indexOf(">") == -1) {
                                                length += v.length
                                            }
                                        });
                                        if (length > maxSize) return false;
                                        else return true;
                                    }
                                }
                            }
                        },
                        queryGeneid: {
                            validators: {
                                notEmpty: {
                                    message: "Please either enter geneid into the box!"
                                }
                            }
                        },
                        'db[]': {
                            validators: {
                                notEmpty: {
                                    message: "Database is required！"
                                }
                            }
                        },
                        evalue: {
                            validators: {
                                notEmpty: {
                                    message: 'Evalue is required！'
                                },
                                numeric: {
                                    message: 'Evalue must be number！'
                                },
                                greaterThan: {
                                    value: 0,
                                    message: "Evalue must greater than or equal to 0！"
                                }
                            }
                        },
                        wordSize: {
                            validators: {
                                notEmpty: {
                                    message: 'Word size is required！'
                                },
                                integer: {
                                    message: 'Word size must be intger！'
                                },
                                greaterThan: {
                                    value: 4,
                                    message: "Word size must greater than or equal to 4！"
                                }
                            }
                        },
                        maxTargetSeqs: {
                            validators: {
                                notEmpty: {
                                    message: 'Max target seqs is required！'
                                },
                                integer: {
                                    message: 'Max target seqs must be integer！'
                                },
                                greaterThan: {
                                    value: 0,
                                    message: "Max target seqs must greater than or equal to 0！"
                                }
                            }
                        },
                        qcovHspPerc: {
                            validators: {
                                notEmpty: {
                                    message: 'Percent query coverage per hsp is required！'
                                },
                                integer: {
                                    message: 'Percent query coverage per hsp must be intger！'
                                },
                                between:{
                                    min:0,
                                    max:100,
                                    message:'Percent query coverage per hsp must be between 0 and 100'
                                }
                            }
                        }
                    }
                });
                $('#blastpForm').formValidation({
                    framework: 'bootstrap',
                    icon: {
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {
                        file: {
                            validators: {
                                notEmpty: {
                                    message: "Query fasta is required!"
                                },
                                file: {
                                    extension: 'fa,fasta',
                                    maxSize: maxSize,
                                    message: 'Query fasta file must be fasta file and file size must be <= 20MB！'
                                }
                            }
                        },
                        queryText: {
                            validators: {
                                notEmpty: {
                                    message: "Please either enter sequences into the box!"
                                },
                                callback: {
                                    message: 'Query sequence length must be <= 20MB!',
                                    callback: function (seqs) {
                                        var line = seqs.split("\n");
                                        var length = 0;
                                        $.each(line, function (i, v) {
                                            if (v.indexOf(">") == -1) {
                                                length += v.length
                                            }
                                        });
                                        if (length > maxSize) return false;
                                        else return true;
                                    }
                                }
                            }
                        },
                        queryGeneid: {
                            validators: {
                                notEmpty: {
                                    message: "Please either enter geneid into the box!"
                                }
                            }
                        },
                        'db[]': {
                            validators: {
                                notEmpty: {
                                    message: "Database is required！"
                                }
                            }
                        },
                        evalue: {
                            validators: {
                                notEmpty: {
                                    message: 'Evalue is required！'
                                },
                                numeric: {
                                    message: 'Evalue must be number！'
                                },
                                greaterThan: {
                                    value: 0,
                                    message: "Evalue must greater than or equal to 0！"
                                }
                            }
                        },
                        wordSize: {
                            validators: {
                                notEmpty: {
                                    message: 'Word size is required！'
                                },
                                integer: {
                                    message: 'Word size must be intger！'
                                },
                                between: {
                                    min: 0,
                                    max: 8,
                                    inclusive: false,
                                    message: "Word size must less than  8！"
                                }
                            }
                        },
                        maxTargetSeqs: {
                            validators: {
                                notEmpty: {
                                    message: 'Max target seqs is required！'
                                },
                                integer: {
                                    message: 'Max target seqs must be integer！'
                                },
                                greaterThan: {
                                    value: 0,
                                    message: "Max target seqs must greater than or equal to 0！"
                                }
                            }
                        }
                    }
                });
            }

            $("#input-1").fileinput({
                showPreview: false
            });

    </script>


}